# Longitudinal Metagenome QC Tool

A robust, user-friendly pipeline for detecting **mislabeled**, **abnormal**, and **duplicate** samples in longitudinal metagenomic studies.  
Designed for reproducibility, transparency, and seamless integration with large-scale bioinformatics workflows.

---

## Features

- **Detects mislabeled/abnormal samples** within each individual based on Bray-Curtis distances.
- **Identifies batch-level duplicates ("cheating" samples)** for quality assurance.
- **Suggests the most likely true sample partner** for each flagged mislabel.
- Produces **clean, simple, and machine-friendly output files** with clear documentation.
- Efficient: fast CLI help, vectorized analysis, scalable to thousands of samples.

---

## Requirements

- **Python 3.7+**
- Python packages:
  - `numpy`
  - `pandas`
  - `scipy`
  - `networkx`
  - `matplotlib`
  - `scikit-learn`

Install requirements with:
```bash
pip install numpy pandas scipy networkx matplotlib scikit-learn
```

# Usage
```bash
python find_abnormality.py abundance.tsv meta.tsv -s output_prefix [-c 0.3]
```

## Input File Examples
abudance.tsv(tab-delimited):
|        | sample1 | sample2 | sample3 |
|--------|---------|---------|---------|
| s__A   |   2.5   |   4.2   |   0.0   |
| s__B   |   0.0   |   1.3   |   0.9   |
| s__C   |   1.1   |   0.0   |   2.2   |

meta.tsv(tab-delimited)
| sample_id | patient | batch   |
|-----------|---------|---------|
| sample1   | PAT01   | batch_0 |
| sample2   | PAT01   | batch_1 |
| sample3   | PAT02   | batch_1 |



# Output File Guide: Longitudinal Metagenome QC Tool

This document describes the output files generated by the longitudinal metagenome quality control (QC) pipeline.

---

## 1. `<prefix>_mislabeled_sns.tsv`

**Purpose:**  
Lists sample pairs within each patient flagged as *mislabeled* based on anomalous distances.

**Columns:**
- `patient_id`: Patient/subject identifier.
- `sample1`, `sample2`: The two sample IDs compared.
- `rank1`, `rank2`: Rank of this distance in each sample's distance vector (higher = more "unusual").
- `total_samples`: Number of samples for this patient.
- `flag_type`: Always `mislabeled` in this file.

**Example:**


---

## 2. `<prefix>_cheating_sns.tsv`

**Purpose:**  
Lists sample pairs within batches that are suspiciously similar ("cheating" or likely duplicates).

**Columns:**
- `batch`: Batch name or label.
- `sample1`, `sample2`: The two sample IDs identified as likely duplicates.
- `bray_curtis_distance`: Bray-Curtis distance between these samples (lower = more similar).
- `cheating_group`: Arbitrary group label for reporting (e.g., C1, C2).

**Example:**

---

## 3. `<prefix>_true_labels.tsv`

**Purpose:**  
Suggests the most likely *true patient partner* for each sample identified as mislabeled.

**Columns:**
- `mislabeled_sample`: The sample flagged as problematic.
- `top_candidate_patient`: Patient with lowest mean Bray-Curtis distance to this sample.
- `distance_score`: The (mean) Bray-Curtis distance for this candidate.
- `normal_samples`: List of other "normal" samples for the same patient.

**Example:**


---

## 4. `<prefix>.pkl`

**Purpose:**  
Python pickle file containing the intermediate results for advanced users or downstream scripting.

---

## Notes

- All files are **tab-delimited** (`.tsv`) and include header rows.
- The `<prefix>` is user-defined via the `-s` argument when running the pipeline (default: `results`).
- If only one batch is present, only the cheating/deduplication file is generated.

---

# License
MIT License

# Contact
zhouyong0530@outlook.com

